From: Russell Coker <russell@coker.com.au>
Date: Sun, 26 Feb 2012 19:39:24 +0100
Subject: build system

---
 Makefile                |    6 ++++--
 mcstrans/src/Makefile   |    3 ++-
 mcstrans/utils/Makefile |    2 +-
 restorecond/Makefile    |    6 +++---
 run_init/Makefile       |    2 +-
 sandbox/Makefile        |    4 ++--
 semodule_deps/Makefile  |    2 +-
 sepolgen-ifgen/Makefile |    2 +-
 8 files changed, 15 insertions(+), 12 deletions(-)

--- a/Makefile
+++ b/Makefile
@@ -1,11 +1,13 @@
 SUBDIRS = sepolicy setfiles semanage load_policy newrole run_init sandbox secon audit2allow sestatus semodule_package semodule semodule_link semodule_expand semodule_deps sepolgen-ifgen setsebool scripts po man gui
 
-INOTIFYH = $(shell ls /usr/include/sys/inotify.h 2>/dev/null)
+INOTIFYH = $(shell ls /usr/include/$(DEB_HOST_MULTIARCH)/sys/inotify.h 2>/dev/null)
 
-ifeq (${INOTIFYH}, /usr/include/sys/inotify.h)
+ifneq (${INOTIFYH},)
 	SUBDIRS += restorecond
 endif
 
+SUBDIRS += restorecond mcstrans
+
 all install relabel clean indent:
 	@for subdir in $(SUBDIRS); do \
 		(cd $$subdir && $(MAKE) $@) || exit 1; \
--- a/mcstrans/src/Makefile
+++ b/mcstrans/src/Makefile
@@ -13,6 +13,7 @@ ifeq "$(ARCH)" "i386"
 endif
 endif
 endif
+LIBDIR=/usr/lib/$(DEB_HOST_MULTIARCH)
 # Installation directories.
 PREFIX  ?= $(DESTDIR)/usr
 SBINDIR ?= $(DESTDIR)/sbin
--- a/mcstrans/utils/Makefile
+++ b/mcstrans/utils/Makefile
@@ -17,7 +17,7 @@ ifeq "$(ARCH)" "i386"
 endif
 endif
 endif
-
+LIBDIR=/usr/lib/$(DEB_HOST_MULTIARCH)
 
 CFLAGS ?= -Wall
 override CFLAGS += -I../src -D_GNU_SOURCE
--- a/restorecond/Makefile
+++ b/restorecond/Makefile
@@ -11,11 +11,11 @@ autostart_DATA = sealertauto.desktop
 INITDIR ?= $(DESTDIR)/etc/rc.d/init.d
 SELINUXDIR = $(DESTDIR)/etc/selinux
 
-DBUSFLAGS = -DHAVE_DBUS -I/usr/include/dbus-1.0 -I/usr/lib64/dbus-1.0/include -I/usr/lib/dbus-1.0/include
+DBUSFLAGS = -DHAVE_DBUS -I/usr/include/dbus-1.0 -I/usr/lib/$(DEB_HOST_MULTIARCH)/dbus-1.0/include -I/usr/lib/dbus-1.0/include
 DBUSLIB = -ldbus-glib-1 -ldbus-1
 
 CFLAGS ?= -g -Werror -Wall -W
-override CFLAGS += -I$(PREFIX)/include $(DBUSFLAGS) -I/usr/include/glib-2.0 -I/usr/lib64/glib-2.0/include -I/usr/lib/glib-2.0/include
+override CFLAGS += -I$(PREFIX)/include $(DBUSFLAGS) -I/usr/include/glib-2.0 -I/usr/lib/$(DEB_HOST_MULTIARCH)/glib-2.0/include -I/usr/lib/glib-2.0/include
 
 LDLIBS += -lselinux $(DBUSLIB) -lglib-2.0 -L$(LIBDIR)
 
--- a/semodule_deps/Makefile
+++ b/semodule_deps/Makefile
@@ -2,7 +2,7 @@
 PREFIX ?= $(DESTDIR)/usr
 INCLUDEDIR ?= $(PREFIX)/include
 BINDIR ?= $(PREFIX)/bin
-LIBDIR ?= $(PREFIX)/lib
+LIBDIR ?= $(PREFIX)/lib/$(DEB_HOST_MULTIARCH)
 MANDIR ?= $(PREFIX)/share/man
 
 CFLAGS ?= -Werror -Wall -W
--- a/sepolgen-ifgen/Makefile
+++ b/sepolgen-ifgen/Makefile
@@ -1,7 +1,7 @@
 # Installation directories.
 PREFIX ?= $(DESTDIR)/usr
 BINDIR ?= $(PREFIX)/bin
-LIBDIR ?= $(PREFIX)/lib
+LIBDIR ?= $(PREFIX)/lib/$(DEB_HOST_MULTIARCH)
 INCLUDEDIR ?= $(PREFIX)/include
 
 CFLAGS ?= -Werror -Wall -W
